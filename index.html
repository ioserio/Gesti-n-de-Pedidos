<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gestión de Pedidos</title>
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <link rel="stylesheet" href="estilos.css?v=mobile1">
        <style>
            /* Fallback si el CSS queda en caché en móviles */
            body.is-mobile table.resumen-desktop { display: none !important; }
            body.is-mobile .resumen-mobile { display: block !important; }
        </style>
</head>
<body>
    <header>
        <nav>
            <a href="index.php" class="brand-logo" aria-label="RikFlex Home">RikFlex</a>
            <!-- Botón hamburguesa para móviles -->
            <button class="mobile-nav-toggle" aria-label="Abrir menú" aria-expanded="false" aria-controls="mobile-menu" type="button">
                <span class="mn-bar"></span>
                <span class="mn-bar"></span>
                <span class="mn-bar"></span>
            </button>
            <ul class="menu">
                <li><a href="#" data-mod="importar" onclick="mostrarModulo('subir')"><span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 3l4 4h-3v6h-2V7H8l4-4z"/><path d="M4 14h16v5a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-5z"/></svg></span>Importar</a></li>
                <!-- Menú desplegable para Resumen de Pedidos -->
                <li class="has-submenu">
                    <a href="#" class="submenu-toggle" aria-haspopup="true" aria-expanded="false">
                        <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="10" width="4" height="10" rx="1"/><rect x="10" y="6" width="4" height="14" rx="1"/><rect x="17" y="3" width="4" height="17" rx="1"/></svg></span>
                        Pedidos
                        <span class="caret" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                    </a>
                    <ul class="submenu">
                        <li>
                            <a href="#" data-mod="consultar" onclick="mostrarModulo('consultar')">
                                <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="11" cy="11" r="6"/><path d="M20 20l-4.35-4.35" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"/></svg></span>
                                Consulta por vd
                            </a>
                        </li>
                        <li>
                            <a href="#" data-mod="resumen" onclick="mostrarModulo('resumen')">
                                <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="10" width="4" height="10" rx="1"/><rect x="10" y="6" width="4" height="14" rx="1"/><rect x="17" y="3" width="4" height="17" rx="1"/></svg></span>
                                Resumen de Pedidos
                            </a>
                        </li>
                    </ul>
                </li>
                <li><a href="#" data-mod="cobranzas" onclick="mostrarModulo('cobranzas')"><span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 1a4 4 0 00-4 4v1H6a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V8a2 2 0 00-2-2h-2V5a4 4 0 00-4-4zm-2 5V5a2 2 0 114 0v1h-4z"/></svg></span>Gestión de Cobranzas</a></li>
                <li class="has-submenu">
                    <a href="#" class="submenu-toggle" aria-haspopup="true" aria-expanded="false">
                        <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 5v4H7l5 5 5-5h-5V5z"/><path d="M5 19h14v-2H5v2z"/></svg></span>
                        Gestión de Devoluciones
                        <span class="caret" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                    </a>
                    <ul class="submenu">
                        <li><a href="#" data-mod="devoluciones" onclick="mostrarModulo('devoluciones')">Clasificaciones</a></li>
                        <li><a href="#" data-mod="recojos" onclick="mostrarModulo('recojos')">Consulta de Recojos</a></li>
                    </ul>
                </li>
                <li class="has-submenu">
                    <a href="#" class="submenu-toggle" aria-haspopup="true" aria-expanded="false">
                        <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.14 12.94a7.46 7.46 0 000-1.88l2.03-1.58a.5.5 0 00.12-.64l-1.92-3.32a.5.5 0 00-.6-.22l-2.39.96a7.52 7.52 0 00-1.63-.95L14.5 1.9a.5.5 0 00-.49-.4h-3.99a.5.5 0 00-.49.4l-.36 2.41c-.57.23-1.11.54-1.63.95l-2.39-.96a.5.5 0 00-.6.22L2.64 8.35a.5.5 0 00.12.64l2.03 1.58c-.05.31-.08.63-.08.94s.03.63.08.94L2.76 14.03a.5.5 0 00-.12.64l1.92 3.32c.14.24.44.34.7.22l2.39-.96c.51.41 1.06.73 1.63.95l.36 2.41c.06.24.26.4.49.4h3.99c.23 0 .43-.16.49-.4l.36-2.41c.57-.23 1.11-.54 1.63-.95l2.39.96c.26.11.56.01.7-.22l1.92-3.32a.5.5 0 00-.12-.64l-2.03-1.58zM12 15.5A3.5 3.5 0 1112 8a3.5 3.5 0 010 7.5z"/></svg></span>
                        Administrador
                        <span class="caret" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                    </a>
                    <ul class="submenu">
                        <li><a href="#" data-mod="admin" onclick="mostrarModulo('admin')">Administrador de Cuotas</a></li>
                        <li><a href="#" data-mod="rutas" onclick="mostrarModulo('rutas')">Rutas</a></li>
                        <li><a href="#" data-mod="ctacte_vendedor" onclick="mostrarModulo('ctacte_vendedor')">CTACTE/Vendedor</a></li>
                        <li><a href="#" data-mod="usuarios" onclick="mostrarModulo('usuarios')">Usuarios</a></li>
                        <li><a href="#" data-mod="permisos" onclick="mostrarModulo('permisos')">Permisos</a></li>
                        <li><a href="#" data-mod="sesiones" onclick="mostrarModulo('sesiones')">Usuarios en línea</a></li>
                    </ul>
                </li>
                <li id="user-info" class="push-right"><a href="#" tabindex="-1" style="opacity:.95; cursor:default;">
                    <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="4" fill="currentColor"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>
                    <span id="user-name">Cargando...</span>
                </a></li>
                <li><a href="logout.php"><span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 17v2a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-6a2 2 0 0 0-2 2v2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 12H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M6 9l-3 3 3 3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>Salir</a></li>
            </ul>
        </nav>
    </header>
    <!-- Panel de menú móvil (clonado vía JS de la lista principal) -->
    <div id="mobile-menu" class="mobile-menu-panel" aria-hidden="true"></div>
    <div class="container">
    <section id="modulo-inicio">
        <h2>Bienvenido</h2>
        <p>Selecciona un módulo desde el menú superior para comenzar. Si no ves algún módulo, puede que tu usuario no tenga permisos para acceder a él.</p>
    </section>
    <section id="modulo-subir" style="display:none;">
        <h2>Subir archivo Excel de Pedidos</h2>
        <form action="procesar_excel.php" method="post" enctype="multipart/form-data">
            <input type="file" name="archivo_excel" accept=".xlsx,.xls" required>
            <button type="submit">Subir</button>
        </form>
        <div id="preview"></div>

        <hr style="margin:24px 0;">

        <h2>Subir Excel de Devoluciones por Cliente</h2>
        <p>Selecciona tu archivo <b>DEVOLUCIONES POR CLIENTE.xlsx</b> para cargarlo en la tabla <code>devoluciones_por_cliente</code>.</p>
        <form action="procesar_devoluciones.php" method="post" enctype="multipart/form-data" style="margin-top:10px;">
            <input type="file" name="archivo_devoluciones" accept=".xlsx,.xls" required>
            <label style="margin-left:14px;">
                Fecha:
                <input type="date" name="fecha_devoluciones" required>
            </label>
            <label style="margin-left:14px;">
                <input type="checkbox" name="replace_all" value="1" checked>
                Reemplazar registros de esa fecha
            </label>
            <button type="submit" style="margin-left:14px;">Subir Devoluciones</button>
        </form>

        <hr style="margin:24px 0;">

        <h2>Subir Excel de Cobranzas (Cuentas por Cobrar y Pagar)</h2>
        <p>Selecciona tu archivo <b>CUENTAS POR COBRAR Y PAGAR.xlsx</b> para cargarlo en la tabla <code>cuentas_por_cobrar_pagar</code>.</p>
        <form action="procesar_cobranzas.php" method="post" enctype="multipart/form-data" style="margin-top:10px;">
            <input type="file" name="archivo_cobranzas" accept=".xlsx,.xls" required>
            <label style="margin-left:14px; display:inline-flex; align-items:center; gap:6px;">
                <input type="checkbox" name="truncate" value="1">
                Vaciar tabla antes de importar
            </label>
            <button type="submit" style="margin-left:14px;">Subir Cobranzas</button>
        </form>
    </section>
    <section id="modulo-consultar" style="display:none;">
        <h2>Consultar Pedidos por Vendedor</h2>
        <form id="form-consultar">
            <label for="cod_vendedor">Código de Vendedor:</label>
            <input type="text" id="cod_vendedor" name="cod_vendedor" required>
            <button type="submit">Consultar</button>
        </form>
        <div id="resultados"></div>
    </section>
    <section id="modulo-resumen" style="display:none;">
        <h2>Resumen de Pedidos por Vendedor</h2>
    <form id="form-resumen" style="margin-bottom:20px; display:flex; flex-wrap:wrap; align-items:center; gap:10px;">
            <label for="fecha_resumen">Fecha:</label>
            <input type="date" id="fecha_resumen" name="fecha_resumen" value="" required>
            <label for="supervisor_resumen" style="margin-left:15px;"><b>Supervisor:</b></label>
            <select id="supervisor_resumen" name="supervisor_resumen">
                <option value="">Todos</option>
                <option value="JOSE">JOSE</option>
                <option value="CARLOS">CARLOS</option>
                <option value="JESUS">JESUS</option>
                <option value="FRANCISCO">FRANCISCO</option>
                <option value="OFICINA">OFICINA</option>
            </select>
            <button type="submit">Consultar</button>
            <span id="ultima_actualizacion" style="margin-left:auto; color:#555; font-weight:600; white-space:nowrap;"></span>
        </form>
        <div id="resumen"></div>
    </section>
    <section id="modulo-cobranzas" style="display:none;">
        <h2>Gestión de Cobranzas</h2>
        <form id="form-cobranzas" style="margin-bottom:15px; display:flex; flex-wrap:wrap; gap:10px; align-items:center;">
            <label for="sup_cobranza">Supervisor:</label>
            <select id="sup_cobranza" style="min-width:220px;"></select>
            <label for="vd_cobranza_sel" style="margin-left:6px;">Vendedor:</label>
            <select id="vd_cobranza_sel" name="cod_vendedor" style="min-width:140px;"></select>
            <button type="submit">Consultar</button>
        </form>
        <div id="cobranzas"></div>
    </section>
    <section id="modulo-admin" style="display:none;">
        <h2>Administrador de Cuotas</h2>
        <form id="form-cuota" style="margin-bottom:15px;">
            <label for="cuota_vd">Cod Vendedor:</label>
            <input type="text" id="cuota_vd" name="cod_vendedor" placeholder="Ej: 021" required style="width:90px;">
            <label for="cuota_dia" style="margin-left:10px;">Día:</label>
            <select id="cuota_dia" name="dia_semana">
                <option value="1">Lunes</option>
                <option value="2">Martes</option>
                <option value="3">Miércoles</option>
                <option value="4">Jueves</option>
                <option value="5">Viernes</option>
                <option value="6">Sábado</option>
                <option value="7">Domingo</option>
            </select>
            <label for="cuota_monto" style="margin-left:10px;">Cuota S/</label>
            <input type="number" id="cuota_monto" name="cuota" step="0.01" min="0" required style="width:120px;">
            <button type="submit">Guardar Cuota</button>
        </form>
        <div id="lista-cuotas"></div>
    </section>
    <section id="modulo-ctacte-vendedor" style="display:none;">
        <h2>CTACTE/Vendedor</h2>
        <p style="margin-bottom:10px;color:#555;">Asigna un supervisor a cada vendedor.</p>
        <div id="vs-lista"></div>
    </section>
    <section id="modulo-rutas" style="display:none;">
        <h2>Rutas por Vendedor</h2>
        <form id="form-ruta" style="margin-bottom:15px;">
            <label for="ruta_vd">Cod Vendedor:</label>
            <input type="text" id="ruta_vd" name="cod_vendedor" placeholder="Ej: 021" required style="width:90px;">
            <label for="ruta_dia" style="margin-left:10px;">Día:</label>
            <select id="ruta_dia" name="dia_semana">
                <option value="1">Lunes</option>
                <option value="2">Martes</option>
                <option value="3">Miércoles</option>
                <option value="4">Jueves</option>
                <option value="5">Viernes</option>
                <option value="6">Sábado</option>
                <option value="7">Domingo</option>
            </select>
            <label for="ruta_zona" style="margin-left:10px;">Ruta/Zona:</label>
            <input type="text" id="ruta_zona" name="zona" placeholder="Ej: 6071" required style="width:120px;">
            <button type="submit">Guardar Ruta</button>
        </form>
        <div id="lista-rutas"></div>
    </section>
    <section id="modulo-usuarios" style="display:none;">
        <h2>Usuarios</h2>
        <form id="form-usuario-new" style="margin-bottom:12px; display:flex; flex-wrap:wrap; gap:10px; align-items:center;">
            <label>Usuario: <input type="text" id="u_usuario" name="usuario" required style="width:140px;"></label>
            <label>Nombre: <input type="text" id="u_nombre" name="nombre" required style="min-width:200px;"></label>
            <label>Rol:
                <select id="u_rol" name="rol">
                    <option value="USER">USER</option>
                    <option value="ADMIN">ADMIN</option>
                    <option value="ADMINISTRADOR">ADMINISTRADOR</option>
                    <option value="CUENTACORRIENTE">CUENTACORRIENTE</option>
                    <option value="SUPERVISOR">SUPERVISOR</option>
                    <option value="FACTURADOR">FACTURADOR</option>
                </select>
            </label>
            <label>Activo: <input type="checkbox" id="u_activo" name="activo" checked></label>
            <label>Contraseña: <input type="password" id="u_password" name="password" required style="width:160px;"></label>
            <button type="submit">Crear usuario</button>
        </form>
        <div id="lista-usuarios"></div>
    </section>
    <section id="modulo-sesiones" style="display:none;">
        <h2>Usuarios en línea</h2>
        <div id="lista-sesiones"></div>
    </section>
    <section id="modulo-permisos" style="display:none;">
        <h2>Permisos</h2>
        <p style="margin-bottom:10px; color:#555;">Módulo de administración de permisos. Aquí podrás asignar permisos por usuario/rol. (Borrador)</p>
        <div class="msg-ok" style="display:none;" id="perm-ok"></div>
        <div class="msg-err" style="display:none;" id="perm-err"></div>
        <div id="perm-content">
            <p>Pronto: listado de usuarios y acciones permitidas.</p>
        </div>
    </section>
    <section id="modulo-devoluciones" style="display:none;">
        <h2>Gestión de Devoluciones</h2>
        <form id="form-devoluciones" style="margin-bottom:15px;">
            <label for="fecha_dev">Fecha:</label>
            <input type="date" id="fecha_dev" name="fecha" required>
            <label for="dev_cod_vend" style="margin-left:10px;">Vendedor:</label>
            <input type="text" id="dev_cod_vend" name="cod_vendedor" placeholder="Ej: 021" style="width:90px;">
            <label for="dev_cod_cli" style="margin-left:10px;">Cliente:</label>
            <input type="text" id="dev_cod_cli" name="cod_cliente" placeholder="Código" style="width:120px;">
            <label for="dev_veh" style="margin-left:10px;">Vehículo:</label>
            <select id="dev_veh" name="vehiculo" style="min-width:180px;">
                <option value="">Todos (cargar lista)</option>
            </select>
            <button type="submit" style="margin-left:10px;">Consultar</button>
        </form>
        <div id="devoluciones"></div>
    </section>
    <section id="modulo-recojos" style="display:none;">
        <h2>Consulta de Recojos</h2>
        <form id="form-recojos" style="margin-bottom:15px; display:flex; flex-wrap:wrap; gap:10px; align-items:center;">
            <label for="fecha_recojo_desde">Desde:</label>
            <input type="date" id="fecha_recojo_desde" name="fecha_desde">
            <label for="fecha_recojo_hasta" style="margin-left:10px;">Hasta:</label>
            <input type="date" id="fecha_recojo_hasta" name="fecha_hasta">
            <label for="supervisor_recojo" style="margin-left:10px;">Supervisor:</label>
            <select id="supervisor_recojo" name="supervisor" style="width:120px;">
                <option value="">Todos</option>
                <option value="JOSE">JOSE</option>
                <option value="CARLOS">CARLOS</option>
                <option value="JESUS">JESUS</option>
                <option value="FRANCISCO">FRANCISCO</option>
                <option value="OFICINA">OFICINA</option>
            </select>
            <label for="vd_recojo" style="margin-left:10px;">Vendedor:</label>
            <input type="text" id="vd_recojo" name="cod_vendedor" placeholder="Ej: 021" style="width:90px;">
            <label for="cliente_recojo" style="margin-left:10px;">Cliente:</label>
            <input type="text" id="cliente_recojo" name="cliente" placeholder="Código o nombre" style="width:160px;">
            <label style="display:inline-flex; align-items:center; gap:6px; margin-left:10px;">
                <input type="checkbox" id="recojo_pend" name="pendientes" value="1">
                Filtrar pendientes
            </label>
            <button type="submit" style="margin-left:10px;">Consultar</button>
        </form>
        <div id="recojos"></div>
    </section>
    </div>
    <script src="script.js"></script>
</body>
</html>
